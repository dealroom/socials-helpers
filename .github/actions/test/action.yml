# Auto-synced file, managed by [dealroom/core-mothership](https://github.com/dealroom/core-mothership)
# Do not edit by hand, your change will be automatically overwritten on the next sync.

name: PHP Test
description: Test the codebase and upload coverage to Code Climate
inputs:
  cc-reporter-id:
    description: Code Climate reporter ID
    required: true
runs:
  using: "composite"
  steps:
    - name: Setup Code Climate Reporter
      shell: bash
      run: |
        curl -L https://codeclimate.com/downloads/test-reporter/test-reporter-latest-linux-amd64 > ./cc-test-reporter
        chmod +x ./cc-test-reporter
        ./cc-test-reporter before-build
    - name: Test with phpunit
      shell: bash
      run: vendor/bin/phpunit --coverage-clover clover.xml
    - name: Upload coverage
      if: ${{ success() }}
      shell: bash
      run: ./cc-test-reporter after-build --coverage-input-type clover
      env:
        CC_TEST_REPORTER_ID: ${{ inputs.cc-reporter-id }}
