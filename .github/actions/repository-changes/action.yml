# Auto-synced file, managed by [dealroom/mothership](https://github.com/dealroom/mothership)
# The changes to this file will be automatically overwritten on the next sync. Do not edit by hand!

name: Check Repository Changes
description: Checks if there are any changes in the terraform, charts, or only in the .github directory
outputs:
  terraform:
    description: true if there are changes in the terraform directory
    value: ${{ steps.changes.outputs.terraform }}
  charts:
    description: true if there are changes in the charts directory
    value: ${{ steps.changes.outputs.charts }}
  github-only:
    description: true if only .github/ directory files changed
    value: ${{ steps.check-github-only.outputs.result }}
runs:
  using: composite
  steps:
    - name: Get previous tag
      id: last-tag
      # This runs for any tag event (releases, manual tag pushes, etc.)
      if: github.ref_type == 'tag'
      uses: WyriHaximus/github-action-get-previous-tag@04e8485ecb6487243907e330d522ff60f02283ce # v1.4.0

    - name: Calculate changed paths
      id: changes
      uses: dorny/paths-filter@de90cc6fb38fc0963ad72b210f1f284cd68cea36 # v3.0.2
      with:
        # For tag pushes/releases, compare with the previous tag.
        # For branch pushes and pull requests, the action automatically determines the correct base.
        base: ${{ github.ref_type == 'tag' && steps.last-tag.outputs.tag || '' }}
        filters: |
          terraform:
            - 'terraform/**'
          charts:
            - 'charts/**'
          github:
            - '.github/**'
          # This filter is true if any file *outside* of the .github directory has changed.
          non_github:
            - '**'
            - '!.github/**'
    - name: Determine if only .github files changed
      id: check-github-only
      shell: bash
      run: |
        # This condition is met if files within '.github/' have changed,
        # but no files outside of that directory have changed.
        if [[ "${{ steps.changes.outputs.github }}" == "true" && "${{ steps.changes.outputs.non_github }}" == "false" ]]; then
          echo "result=true" >> $GITHUB_OUTPUT
        else
          echo "result=false" >> $GITHUB_OUTPUT
        fi
