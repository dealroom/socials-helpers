# Auto-synced file, managed by [dealroom/mothership](https://github.com/dealroom/mothership)
# The changes to this file will be automatically overwritten on the next sync. Do not edit by hand!

name: Reusable Security Scanning

on:
  workflow_call:

permissions: {}

jobs:
  checkov:
    name: Checkov IaC Scan
    permissions:
      contents: read
      pull-requests: write
      id-token: write
      packages: read
    uses: ./.github/workflows/reusable_security_checkov.yml
    with:
      soft-fail: false

  trivy:
    name: Trivy Vulnerability Scan
    permissions:
      contents: read
      pull-requests: write
      id-token: write
      packages: read
    uses: ./.github/workflows/reusable_security_trivy.yml
    with:
      severity: CRITICAL,HIGH,MEDIUM

  kyverno:
    name: Kyverno Policy Check
    permissions:
      contents: read
      pull-requests: write
      id-token: write
      packages: read
    uses: ./.github/workflows/reusable_security_kyverno.yml

  security-check-results:
    if: ${{ always() }}
    runs-on: ubuntu-slim
    name: Security Checks Result
    needs: [checkov, trivy, kyverno]
    permissions:
      contents: read
    steps:
      - name: Checkout Repository
        uses: actions/checkout@8e8c483db84b4bee98b60c0593521ed34d9990e8 # v6.0.1
        with:
          persist-credentials: false
      - name: Aggregate Security Results
        uses: ./.github/actions/test-results
        with:
          needs: ${{ toJson(needs) }}
